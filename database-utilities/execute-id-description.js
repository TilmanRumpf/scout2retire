import { createClient } from '@supabase/supabase-js';
import dotenv from 'dotenv';

dotenv.config();

const supabase = createClient(
  process.env.VITE_SUPABASE_URL,
  process.env.SUPABASE_SERVICE_ROLE_KEY
);

async function executeIdDescription() {
  console.log('üìù Adding description to id column in towns table...\n');

  const sql = `COMMENT ON COLUMN public.towns.id IS 'Primary key (UUID) - Auto-generated by database. NOT EDITABLE. Used for unique town identification.';`;

  console.log('Executing SQL:');
  console.log(sql);
  console.log('\n');

  try {
    // Execute raw SQL using Supabase client
    const { data, error } = await supabase.rpc('exec', { sql });

    if (error) {
      console.log('‚ö†Ô∏è  RPC method not available, trying alternative approach...\n');

      // Alternative: Use pg connection directly via a simple query
      // This won't work via REST API, so we'll use a workaround
      const { data: result, error: queryError } = await supabase
        .from('towns')
        .select('id')
        .limit(1);

      if (queryError) {
        console.error('‚ùå Database connection error:', queryError);
        console.log('\nüìã Please run this SQL manually in Supabase SQL Editor:\n');
        console.log(sql);
        return;
      }

      console.log('‚úÖ Database connection verified');
      console.log('\nüìã However, COMMENT statements require direct SQL execution.');
      console.log('Please copy and run this SQL in Supabase SQL Editor:\n');
      console.log('---');
      console.log(sql);
      console.log('---');
      console.log('\nSteps:');
      console.log('1. Go to: https://supabase.com/dashboard/project/axlruvvsjepsulcbqlho/sql');
      console.log('2. Paste the SQL above');
      console.log('3. Click "Run"');
      console.log('4. Refresh Database Tables view to see the description');
      return;
    }

    console.log('‚úÖ Successfully added description to id column!');
    console.log('\nüîç Verification:');
    console.log('Go to: Database ‚Üí Tables ‚Üí towns ‚Üí id column');
    console.log('Description should now show: "Primary key (UUID) - Auto-generated by database. NOT EDITABLE."');

  } catch (err) {
    console.error('‚ùå Unexpected error:', err.message);
    console.log('\nüìã Please run this SQL manually in Supabase SQL Editor:\n');
    console.log(sql);
  }
}

executeIdDescription();
