import { createClient } from '@supabase/supabase-js';
import dotenv from 'dotenv';
import fs from 'fs';

dotenv.config();

const supabase = createClient(
  process.env.VITE_SUPABASE_URL,
  process.env.SUPABASE_SERVICE_ROLE_KEY
);

async function addIdDescription() {
  console.log('üìù Adding description to id column...\n');

  // Read the migration file
  const sql = fs.readFileSync('supabase/migrations/20251028_add_id_column_description.sql', 'utf8');

  console.log('SQL to execute:');
  console.log(sql);
  console.log('\n---\n');

  try {
    const { data, error } = await supabase.rpc('exec_sql', { sql_query: sql });

    if (error) {
      console.error('‚ùå Error:', error);

      // Try direct execution if rpc fails
      console.log('\nüîÑ Trying direct execution...\n');

      const { error: directError } = await supabase
        .from('_migrations')
        .insert({ name: '20251028_add_id_column_description' });

      if (directError) {
        console.error('‚ùå Direct execution also failed:', directError);
        console.log('\nüìã Manual execution required:');
        console.log('Please run this SQL in Supabase SQL Editor:');
        console.log('---');
        console.log(sql);
        console.log('---');
      }
      return;
    }

    console.log('‚úÖ Successfully added description to id column!');
    console.log('\nüîç Verification:');
    console.log('Go to Supabase ‚Üí Database ‚Üí Tables ‚Üí towns ‚Üí id column');
    console.log('You should now see: "Primary key (UUID) - Auto-generated by database. NOT EDITABLE."');
  } catch (err) {
    console.error('‚ùå Unexpected error:', err);
    console.log('\nüìã Please run this SQL manually in Supabase SQL Editor:');
    console.log('---');
    console.log(sql);
    console.log('---');
  }
}

addIdDescription();
